These are very brief, likely incomplete, installation instructions.  If you
want to install the system, follow these instructions as they are and
send any questions to info@mediacloud.org.

These instructions assume comfort with postgresql and especially with perl. You
may have a difficult time installing the system if you do not have experience
with perl and cpan. 

NOTE: THESE INSTRUCTIONS HAVE ONLY BEEN TESTED ON UBUNTU LINUX. We recommend using Ubuntu 11.10 (Oneiric) or later. Earlier versions may be missing some of the necessary packages. Additionally mediacloud requires a 64 bit OS.

NOTE: We recommend you create a new user to run and install Media Cloud. These instructions assume that the user running media cloud does not already have Perlbrew installed. Creating a new user is the safest way to ensure this is the case.

* Install postgresql (8.4 or greater).  Make sure that plperl support
  is included in your postgresql installation, or install the necessary
  addon packages for it.  E.g. on Ubuntu run: 
  	sudo apt-get install postgresql-8.4 postgresql-client-8.4 postgresql-plperl-8.4 postgresql-server-dev-8.4;

   (The postgresql server dev package is needed by some of the perl modules that mediacloud depends on.)

* Create a postgres database and user.  The database user must be a superuser
  to run some of the plperl procedural scripts. Run the following commands:
     sudo su -
     su - postgres
     createuser -s mediaclouduser --pwprompt 
     createdb --owner mediaclouduser mediacloud
     exit
     exit

* Create a postgres test database. This database is used for running the test suite. Be aware that it will be replaced every time the test suite is run. Run the following commands:
     sudo su -
     su - postgres
     createdb --owner mediaclouduser mediacloud_test
     exit
     exit

* Copy mediawords.yml.dist to mediawords.yml.

* Fill in the database section in mediawords.yml with the connection information for the databases you created above. NOTE: The label field for the test database must be 'test' and the test database must be listed after the main database.

* OPTIONAL: Edit the other sections of mediawords.yml to suit your local
  configuration.  NOTE THAT if you uncomment a suboption, you also need to uncomment the parent option.  For example, if you uncomment 'default_tag_module', you should also uncomment 'mediawords'.
  
* OPTIONAL: If you want to use calais tagging, you'll need to apply for a calais key 
  and enter the key into mediawords.yml.  Then change 'NYTTopics' for the
  default_tag_modules setting to 'NYTTopics Calais',

* IMPORTANT: On Ubuntu you must install a number of packages. Run the following command to install these packages:
      sudo apt-get install expat postgresql-server-dev-8.4 postgresql-client-8.4 libexpat1-dev libxml2-dev libdb-dev libtest-www-mechanize-perl libtidy-dev  libopengl-perl libgraph-writer-graphviz-perl libgraphviz-perl graphviz graphviz-dev graphviz-doc libgraphviz-dev libyaml-syck-perl liblist-allutils-perl liblist-moreutils-perl libreadonly-perl  libreadonly-xs-perl build-essential make gcc g++ cpanminus

* Install system wide Perl modules that are needed for the pg/plperl stored procedures by CDing to the directory where mediacloud is located and running the following commands:
     sudo -u root -H cpanm -v
     cat lib/MediaWords/Pg/DependsList.pm | grep -v '#' | grep -v MediaWords | grep '^use' | grep -v 'strict;' | grep -v 'HTML::StripPP' | sed -e 's/^use //' | sed -e 's/ qw.*//' | sed -e 's/;$//' | xargs -n 1 sudo -n -u root -H cpanm

*  Run the install_mc_perlbrew_and_modules.sh script. This scripts installs Perlbrew, carton and the required modules. I.E. simply CD to the base directory of mediacloud and run the following. Note that the script will take a long time to complete:
     ./install_mc_perlbrew_and_modules.sh

NOTE this script will fail if you aren't running a 64 bit OS.

* SUGGESTED: Verify that the necessary modules are installed. Run the media cloud coverage test to verify that all required modules have been installed. Run:
      ./script/run_carton.sh  exec -Ilib/ -- prove -r t/compile.t

If there are errors determine which modules are missing and install them by running carton install.

* Make sure that the directory in which Media Cloud is located can be read by the postgres user. Run something like the following:
      chmod +rx ~/

* Run the following:
    ./script/run_with_carton.sh ./script/mediawords_create_db.pl

  This will create create the necessary database tables and procedures within the database you specified above.  Answer 'yes' at the prompt since the database you created above should be empty.
  
* Run ./script/run_plackup_with_carton.sh.  This should start up the web server.
  If the command line returns no errors, go to http://localhost:5000 
  (or replace localhost with whatever host the system is on) to
  access the server.
  
* Walk through the instructions in README.tutorial to setup a source
  in the web app; download, extract, and tag its stories; and browse
  the results.

* Perform brilliant analysis, fix our broken code, document how the system
  works, and otherwise contribute to the project.
