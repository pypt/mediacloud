<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:fb="http://www.facebook.com/2008/fbml" xmlns:og="http://ogp.me/ns#">
<head>
	<title>4 questions voters should ask about Proposition 37</title>
	<meta property="og:title" content="4 questions voters should ask about Proposition 37" />
	<meta property="og:description" content="" />
	  	<meta property="og:image" content="http://img.youtube.com/vi/Wgdvigr0yNQ/2.jpg" />
  	<meta property="og:url" content="http://networkedblogs.com/EmPMS" />
	<meta property="og:site_name" content="Healthy Eating Advisor" />
	<meta property="og:type" content="article" />
    <style type="text/css"><!--

body, .page_content, .page_table {
	background:#fff;
	color:#666;
	font-family:"lucida grande",tahoma,verdana,arial,sans-serif;
	font-size:11px;
	height: 100%;
	margin:0;
	padding:0;
	width: 100%;
	}
html, body, .height_100 {
	height: 100%;
	overflow: hidden;
}
	
a, a:visited {
	color:#999;
	text-decoration:none;
	}
	
a:hover {
	text-decoration:underline;
	}
	
a.voter img {
	border:1px solid transparent;
	border-radius:2px;
		-moz-border-radius:2px;
		-webkit-border-radius:2px;
	height:20px;
	margin-right:1px;
	width:20px;
	}
	
a.voter:hover img {
	border-color:#0068B7;
	}
	
a img {
  border:0;
  }
	
#logo {
  border-radius:20px;
    -moz-border-radius:20px;
    -webkit-border-radius:20px;
  float:left;
	padding:23px 25px 0 0;
	margin-right:8px;
	background:url(http://static.networkedblogs.com/static/images/logo_v5_small.png) no-repeat 0 -3px;
  }
	
#logo:hover {
  background-color:#fff;
  }
	
/* Common Buttons */

a.bt_primary,
a.bt_tertiary {
	border:1px solid #efefef;
	border-radius:2px;
		-moz-border-radius:2px;
		-webkit-border-radius:2px;
	color:#444;
	display:block;
	float:left;
	font-size:11px;
	margin-right:6px;
	padding:0;
	text-align:center;
	text-decoration:none;
	}
	
	/* IE fix */
	a.bt_tertiary {
	  height:20px;
		width:70px;
	  }
		
	a.bt_primary {
    height:14px;
    }

a.bt_primary:hover,
a.bt_tertiary:hover {
	background-color:#0068B7;
	border-color:#0068B7;
	color:#fff;
	}

a.bt_primary {
	background-color:#a0be59;
	border-color:#a0be59;
	color:#fff;
	margin-left:5px;
	padding:3px 6px;
	width:45px;
	}
	
a.bt_primary.off,
a.bt_primary.off:hover {
	background:#D0E1E5;
	border-color:#ccc;
	border-left:0;
	color:#aaa;
	}
	
a.bt_tertiary span {
	background:url(http://static.networkedblogs.com/static/images/sprite_icons.png) no-repeat 0 -20px;
	display:block;
	padding:4px 1em 0 25px;
	}
	
	/* IE fix */
  a.bt_tertiary span {
    height:20px;
    }
	
a.bt_tertiary span.twitter {
	background-position:0 -60px;
	}
	
a.bt_tertiary span.email {
	background-position:0 -100px;
	}

    --></style>
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.3/jquery.min.js"></script>
  <script type="text/javascript" src="http://static.networkedblogs.com/static/js/primer.js?v=5.8"></script>
	<script type="text/javascript">
        function trackEvent(category, action, label, value) {
          _gaq.push(['_trackEvent', category, action, label, value]);
        }
    </script>
</head>
<body>
	<table cellspacing="0" cellpadding="0" class="page_table">
		<tbody>
			<tr>
				<td height="20" style="background:#F7F9FA;border-bottom:1px solid #ccc;padding:10px 9px 8px;">
				<div style="height:25px;overflow:hidden;">
					<div style="float:right;clear:right;padding-top:2px;">
						<a href="http://healthyeatingadvisor.com/blog/?p=1732"
              title="Remove NetworkedBlogs frame"
              style="display:block;padding:3px 25px 3px 0;background: url(http://static.networkedblogs.com/static/images/sprite_icons.png) no-repeat scroll right -400px transparent;"
              >close</a>
          </div>
				
					<a id="logo" href="http://www.networkedblogs.com/" title="NetworkedBlogs.com" target="_blank"></a>
					
					<div style="float:left;width:234px;height:22px;overflow:hidden;">
						<a class="bt_tertiary" href='#' title="Facebook share" onclick="sharePost();return false;"><span class="facebook">Share</span></a>
			            <a class="bt_tertiary" href='#' title="Tweet this" onclick="tweet();return false;"><span class="twitter">Tweet</span></a>
                  <a class="bt_tertiary" href='mailto:?subject=4+questions+voters+should+ask+about+Proposition+37&body=Hi,%20I%20thought%20you%20might%20like%20this:%0Dhttp://networkedblogs.com/EmPMS%0D%0D(via%20http://networkedblogs.com%20news)'
                    title="Send by email"><span class="email">Email</span></a>
					</div>
					
					<a class="bt_primary" id="votebutton" href='#' title="Vote up this article">Up</a>
					
					<a class="bt_primary" style="width:auto;"
					   href='#' title="Follow this blog"
					   onclick="follow();return false;">Follow Healthy Eating Advisor</a>

          <div id="divVoters" style="float:left;">
          </div>
				</div>
				</td>
			</tr>
			<tr>
				<td class="height_100">
					<iframe frameborder="0" scrolling="auto" src="http://healthyeatingadvisor.com/blog/?p=1732" name="content_iframe" class="page_content"></iframe>
	 			</td>
			</tr>
		</tbody>
	</table>

  <div id="fb-root"></div>
  <script>
    var postAttachment = {"picture": "http://img.youtube.com/vi/Wgdvigr0yNQ/2.jpg", "description": "", "link": "http://nblo.gs/EmPMS", "name": "4 questions voters should ask about Proposition 37", "caption": "Healthy Eating Advisor"};
    var voterIds = "";

    var userId = 0;
    var userName = '';
    var userProfilePic = '';

    function getUserInfo(callback) {
      if (userName != '' && userProfilePic != '')
      {
        // We already have the data, no need to send a request.
        if (callback) callback();
        return;
      }
      FB.api(
        {
          method: 'fql.query',
          query: 'SELECT name, pic_square_with_logo FROM user WHERE uid = ' + userId
        },
        function (response) {
          userName  = response[0].name;
          userProfilePic = response[0].pic_square_with_logo;

          if (callback) callback();
        }
      );
    }

    function addVoterPictures() {
      FB.api(
        {
          method: 'fql.query',
          query: 'SELECT uid, name, pic_square_with_logo FROM user WHERE uid IN (' + voterIds + ')'
        },
        function (voters) {
          for (i in voters) {
            addUserPicture(voters[i].uid, voters[i].name, voters[i].pic_square_with_logo);
          }
        }
      );
    }

    function addUserPicture(userId, name, profilePic) {
      $("#divVoters").append("<a id='aVoter_" + userId + "' " +
        "href='#' onclick='window.open(\"http://www.networkedblogs.com/user/" + userId + "\"); trackEvent(\"Toolbar\", \"View Voter Profile\"); return false;' " +
        "class='voter' " +
        "title='" + name + "'>" +
        "<img src='" + profilePic + "' alt='" + name + "' />" +
        "</a>"
      );
    }

    function removeUserPicture(userId) {
      $("#aVoter_" + userId).remove();
    }

    function showUserPicture(userId) {
      $("#aVoter_" + userId).show();
    }

    function hideUserPicture(userId) {
      $("#aVoter_" + userId).hide();
    }

    function vote() {
      trackEvent('Toolbar', 'Vote', 'EmPMS');
      FB.login(function(response) {
        if (!response.authResponse)
          return;

        getUserInfo(function() {
          trackEvent('Toolbar', 'VoteRecord', 'EmPMS');

          // Send the vote to the server
          Primer.ajax(
            "/api_proxy.php?a=post/EmPMS/vote?ref=toolbar",
            {
              "rel": "async-post",
              "onsuccess": function(data) {
              },
              "onerror": function() {
                // Disable vote button
                enableVoteButton();

                // Remove the icon of the user.
                removeUserPicture(userId);
              }
            },
            null, null
          );

          // Disable vote button
          disableVoteButton();

          // Add the icon of the user.
          addUserPicture(userId, userName, userProfilePic);
        });
      }, {
         'scope': "email"
      });
      return false;
    }

    function unvote() {
      trackEvent('Toolbar', 'Unvote', 'EmPMS');
      FB.login(function(response) {
        if (!response.authResponse)
          return;

        trackEvent('Toolbar', 'VoteRecord', 'EmPMS');

        // Send the vote to the server
        Primer.ajax(
          "/api_proxy.php?a=post/EmPMS/unvote?ref=toolbar",
          {
            "rel": "async-post",
            "onsuccess": function(data) {
              // Remove user icon.
              removeUserPicture(userId);
            },
            "onerror": function() {
              // Disable vote button
              disableVoteButton();

              // Re-show user icon.
              showUserPicture(userId);
            }
          },
          null, null
        );

        // Enable vote button
        enableVoteButton();

        // Hide user icon.
        hideUserPicture(userId);

        return false;
      }, {
         'scope': "email"
      });
    }

    function closeToolbar() {
      // Track closing toolbar 
      trackEvent('Toolbar', 'Close', 'EmPMS');
      window.location = "http://healthyeatingadvisor.com/blog/?p=1732";
    }

    function tweet() {
      // Track tweeting event
      trackEvent('Toolbar', 'Tweet', 'EmPMS');
			window.open('http://twitter.com?status=4%20questions%20voters%20should%20ask%20about%20Proposition%2037%20http%3A%2F%2Fnblo.gs%2FEmPMS', '_blank');
			return false;
    }

    function follow(){
      trackEvent('Toolbar', 'FollowClick', 'EmPMS');
      window.open ("http://www.networkedblogs.com/blog/healthy_eating_advisor/popup",
          "NetworkedBlogs", "status=1,toolbar=1,scrollbars=1,width=670,height=450");
    }

    function enableVoteButton() {
      $("#votebutton")
      .unbind()
      .click(function() { vote(); return false; })
      .removeClass("off");

      $("#votebutton").text("Up");
    }

    function disableVoteButton() {
      $("#votebutton")
      .addClass("off")
      .unbind()
      .click(function() { unvote(); return false; });

      $("#votebutton").text("voted");
    }

    function sharePost(postCode) {
      trackEvent('Toolbar', 'Share', 'EmPMS');

      FB.login(function(response) {
        if (!response.authResponse)
          return;

        // Track share event
        trackEvent('Toolbar', 'ShareOpen', 'EmPMS');
		postAttachment['method'] = 'feed';
        FB.ui(postAttachment,
          function(response) {
			if (response && response.post_id)
			  trackEvent('Toolbar', 'SharePublished', 'EmPMS');
          }
        );
      }, {
         'scope': "email"
      });
      return false;
    }

    function fbReady(authResponse)
    {
        addVoterPictures();
        if (authResponse){
            userId = authResponse.userID;
            // Has the user voted for this post?
            if (voterIds.search(userId.toString()) > -1)
              disableVoteButton();
            else
              enableVoteButton();
        }
        else {
            enableVoteButton();
        }
            }
  </script>

  <!-- Facebook -->
  <script>
    window.fbAsyncInit = function() {
        FB.init({appId: '9953271133', status: true, cookie: true,
                 xfbml: false,
                 channelURL : '{{config.APP_ROOT_URL}}/fbchannel.html',
                 oauth  : true // enable OAuth 2.0
                 });
        FB.getLoginStatus(function(response) {
          if (response.authResponse) {
            fbReady(response.authResponse);
          } else {
            fbReady(null);
          }
        });
    };

    (function() {
        var e = document.createElement('script'); 
        e.async = true;
        e.src = document.location.protocol +
                '//connect.facebook.net/en_US/all.js';
        document.getElementById('fb-root').appendChild(e);
    }());
  </script>

  <!-- Google Analytics -->
  <script type="text/javascript">
	var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-11094983-3']);
	_gaq.push(['_setDomainName', 'networkedblogs.com']);
	_gaq.push(['_setAllowHash', 'false']);
    _gaq.push(['_trackPageview']);
	(function() {
	  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
	  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
	  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	})();

	// Protect against cross-site request forgery attacks.
  $(document).ajaxSend(function(event, xhr, settings) {
    function getCookie(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie != '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = jQuery.trim(cookies[i]);
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) == (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    function sameOrigin(url) {
      // url could be relative or scheme relative or absolute
      var host = document.location.host; // host + port
      var protocol = document.location.protocol;
      var sr_origin = '//' + host;
      var origin = protocol + sr_origin;
      // Allow absolute or scheme relative URLs to same origin
      return (url == origin || url.slice(0, origin.length + 1) == origin + '/') ||
        (url == sr_origin || url.slice(0, sr_origin.length + 1) == sr_origin + '/') ||
        // or any other URL that isn't scheme relative or absolute i.e relative.
        !(/^(\/\/|http:|https:).*/.test(url));
    }

    function safeMethod(method) {
      return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
    }

    if (!safeMethod(settings.type) && sameOrigin(settings.url)) {
      // Protect against CSRF by copying Facebook cookie to a header.
      xhr.setRequestHeader("X-FBSR", getCookie('fbsr_9953271133'));
    }
  });

  </script>
</body>
</html>
